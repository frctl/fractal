#! /usr/bin/env node

'use strict';

const semver     = require('semver');
const Liftoff    = require('liftoff');
const yargs      = require('yargs');
const logger     = require('winston');

const cliPackage = require('../package.json');

const Fractal = new Liftoff({
    processTitle: 'fractal',
    moduleName: '@frctl/fractal',
    configName: 'fractal',
});

Fractal.launch({}, function(env){

   if (!env.configPath) {
       logger.error('No local fractal.js file found.');
       process.exit(1);
   }
   if (!env.modulePath) {
       logger.error("Local fractal module not found in %s \n\t Try running `npm install @frctl/fractal`", env.cwd);
       process.exit(1);
   }
   if (semver.gt(cliPackage.version, env.modulePackage.version)) {
       logger.warn(
           "Fractal version mismatch:\n\t Global fractal is %s\n\t Local fractal is %s",
           cliPackage.version,
           env.modulePackage.version
       );
   }

   require(env.configPath);
   var app = require(env.modulePath);
   app.run(yargs);
});
